<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title></title>

<link href='/assets/css/horsey.css' rel='stylesheet' type='text/css' />
<style type="text/css">
	.form-control{ width: 200px; margin-right: 15px;}
	.form-group { float:left;}
	.col_span { margin-top:4px;}
	.page_content { padding:10px; }
	.table_span_pd tr td{ margin:10px;padding-right: 10px;text-align: center; }
	.table_span_pd tr td span{ margin:10px;padding-right: 10px;text-align: left; }
	.form_btn{ width: auto;height: auto;margin: 20px; }
	.form_btn button{ margin:5px;width: 60px; }
	.active{ background: #86F5F0; }
	.input_width{ width: 700px; }
	.input_wid{ width: 200px; }
	.table_pd tr td{ width: 75px;height: 35px;text-align: center; }
	.task_form { margin-top: 20px; }
	.task_form label{ margin-left: 20px; } 
	.task_form input{ margin-left: 8px; }
	.task_header div{ margin:20px; }
	.task_header div label{ margin:0 20px; }
	.task_header div input{ margin:0 5px; }
	.task_header div .task{ width: 300px; }   
	.new_btn { background: #09DDF3;margin-left: 30px;color: white;padding: 4px; }
	.task_ul li{ margin:20px; }
	.task_ul li .task_news{ margin:10px; }
	.task_ul li .task_news label{ margin-right:10px; }
	.task_ul li div span{ margin-right:10px;background:#05BAF5;color:white;padding:5px; }
	.task_ul li .task_news .task{ margin-right:10px;width: 300px; }
	.fb_form{ margin:15px; }

	.rili{  }
	.rlliBox{ background: #fff; min-width: 320px; }
	.rilihead{ background: #86F5F0; color: #fff; height: 40px; line-height: 40px;}
	.riliYear, .riliMonth{ display: inline-block;}
	.riliBtnLeft,.riliBtnRight{ padding: 0 30px;}
	.DaysUL{ overflow: hidden; height: 40px; line-height: 40px; margin-bottom: 10px; border-bottom: 1px solid #f7f7f7; }
	.DaysUL li{ float: left; width: 14.285%; text-align: center;}
	.color_yellow{ color: #e04c43;}
	.riliConTent{ width: 100%; border-collapse: collapse;border-spacing: 0;}
	.rilihead a{ width:14px; height:15px;}
	.riliConTenttr{ border-bottom: 1px solid #f1f1f1; box-sizing: border-box;}
	.riliConTenttr td{ width: 14.285%; text-align: center; display: inline-block;  height: 40px; line-height: 20px; box-sizing: border-box;}
	.addColor{ color: #222;}
	.today { width: 18px; height: 18px; line-height: 20px; border-radius: 18px; background-color: #86F5F0; color: #FFF; font-size: 10px; }
	.cutPay{ color: #e04c43; font-size: 10px; }
	.cutDay{ color: #555; font-size: 13px; text-align: center; }
	.otopMonth{ color: #ccc; font-size: 12px; }
	.obottomMonth{ color: #999; }
</style>
</head>
<body>
<div class="page_content bg_gray" style="display: none;" id="cashsub">
	<div class="box-title">
        <h5>任务单<span>[1236547898]</span></h5>
        <span class="layui-layer-setwin">
            <a class="layui-layer-ico layui-layer-close layui-layer-close1" href="javascript:;"></a>
        </span>
    </div>
    <hr>
    <div class="fb-form">
    	<h4>用户信息</h4>
        <table class="table_span_pd" width="100%" cellspacing="0">
            <tr>
                <td class="">用户账号:</td>
                <td style=""><span class="">13589632587</span></td>
                <td class="" style="">用户昵称:</td>
                <td><span class="">地对地导弹</span></td>
                <td class="" style="">出行时间:</td>
                <td><span class="">2017年3月8日</span></td>
                
            </tr>
            <tr height="40">
            	<td class="" style="">线路编号:</td>
                <td><span class="">54544</span></td>
                <td class="">关联线路:</td>
                <td style="" colspan="3"><span class="">滴答滴答的飞对方的风格刚刚打得方的风格刚刚过</span></td>
            </tr>
        </table>
        <div class="form_btn">
        	<button class="Day1 active">Day 1</button><button class="Day2">Day 2</button><button class="Day3">Day3</button><button class="Day4">Day 4</button><button class="Day5">Day 5</button><button class="Day6">Day 6</button><button class="Day7">Day 7</button>

        </div>
        <div>
        	<h5>5月2日</h5>
        	<table class="table_pd" cellspacing="10">
        	<tr>
	        	<td class="">12:35</td>
	            <td style=""><span style="color: red;">拍摄小视频</span></td>
	            <td class="">12:35</td>
	            <td style=""><span style="color: red;">拍摄小视频</span></td>
	        </tr>
	        <tr>
	        	<td class="">12:35</td>
	            <td style=""><span style="color: red;">拍摄小视频</span></td>
	            <td class="">12:35</td>
	            <td style=""><span style="color: red;">拍摄小视频</span></td>
	        </tr>
	        <tr>
	        	<td class="">12:35</td>
	            <td style=""><span style="color: red;">拍摄小视频</span></td>
	            <td class="">12:35</td>
	            <td style=""><span style="color: red;">拍摄小视频</span></td>
	        </tr>
            </table>
        </div>
    </div>
</div>

<div class="page_content bg_gray" style="display: none;" id="amend">
	<div class="box-title">
        <h5>新建任务单<span>[1236547898]</span></h5>
        <span class="layui-layer-setwin">
            <a class="layui-layer-ico layui-layer-close layui-layer-close1" href="javascript:;"></a>
        </span>
    </div>
    <hr>
    <div>
        <div class="task_form">
        	<label for="input_account">输入用户账号:</label><input type="text" id="input_account">
        	<label for="input_time">选择出行时间:</label><input type="text" id="input_time">
        </div>
        <div class="task_form">
        	<label>请选择关联线路:</label>
        	<select placeholder="请选择关联线路">
				<option value="volvo">香港三日包机游</option>
				<option value="saab">芭提雅三十天包机游</option>
				<option value="opel">Opel</option>
				<option value="audi">Audi</option>
			</select>
        </div>
        <div class="form_btn">
        	<button class="Day1 active">Day 1</button><button class="Day2">Day 2</button><button class="Day3">Day3</button><button class="Day4">Day 4</button><button class="Day5">Day 5</button><button class="Day6">Day 6</button><button class="Day7">Day 7</button>

        </div>
        <h5>5月2日</h5>
        <div class="task_header">
        	<div>
	        	<label>任务一:</label><input type="text" name="task1" class="task"><input type="text" name="task1_time">
	        </div>
	        <div>
	        	<label>任务二:</label><input type="text" name="task2" class="task"><input type="text" name="task2_time">
	        </div>
	        <div>
	        	<label>任务三:</label><input type="text" name="task3" class="task"><input type="text" name="task3_time">
	        </div>
	        <div>
	        	<label>任务四:</label><input type="text" name="task4" class="task"><input type="text" name="task4_time">
	        </div>
        </div>
        <div><button class="new_btn">新增任务</button></div>
        <div class="form_btn">
	    	<button class="sure_btn">确定</button>

	    </div>
    </div>
</div>

<div class="page_content bg_gray" style="display: none;" id="new_task">
	<div class="box-title">
        <h5>新建任务单<span>[1236547898]</span></h5>
        <span class="layui-layer-setwin">
            <a class="layui-layer-ico layui-layer-close layui-layer-close1" href="javascript:;"></a>
        </span>
    </div>
    <hr>
    <div>
        <div class="task_form">
        	<label for="input_account">输入用户账号:</label><input type="text" id="input_account">
        	<input type="submit" value="匹配" class="btn mate" onclick='mate()'/><span></span>
        </div>
        <div class="task_form">
        	
        	<label>请选择关联线路:</label><input type="submit" value="选择关联线路" class="btn chooseline" onclick='chooseline()'/>
        	<label for="input_time">选择出行时间:</label><span class="line_date"></span>
        </div>
        <ul class="task_ul">
        	<li>
				<div>
					<span>Day1</span><span>5月2日</span>
				</div>
		        <div class="task_news">
		        	<div>
			        	<label>任务一:</label><input type="text" name="task1" class="task"><input type="text" name="task1_time">
			        </div>
			        <div>
			        	<label>任务二:</label><input type="text" name="task2" class="task"><input type="text" name="task2_time">
			        </div>
			        <div>
			        	<label>任务三:</label><input type="text" name="task3" class="task"><input type="text" name="task3_time">
			        </div>
		        </div>
		        <div><button class="new_btn">新增任务</button></div>
	        </li>
	        <li>
				<div>
					<span>Day1</span><span>5月2日</span>
				</div>
		        <div class="task_news">
		        	<div>
			        	<label>任务一:</label><input type="text" name="task1" class="task"><input type="text" name="task1_time">
			        </div>
			        <div>
			        	<label>任务二:</label><input type="text" name="task2" class="task"><input type="text" name="task2_time">
			        </div>
			        <div>
			        	<label>任务三:</label><input type="text" name="task3" class="task"><input type="text" name="task3_time">
			        </div>
		        </div>
		        <div><button class="new_btn">新增任务</button></div>
	        </li>
        </ul>

        <div class="form_btn">
	    	<button class="sure_btn">提交</button>

	    </div>
    </div>
</div>

<div class="fb-content form1" id="form2_add" style="display:none;">
	    <div class="box-title">
	        <h5>选择线路</h5>
	        <span class="layui-layer-setwin">
	            <a class="layui-layer-ico layui-layer-close layui-layer-close1" href="javascript:;" id="close-line"></a>
	        </span>
	    </div>
	    <div class="fb_form">
			<input type="text" class="form-control col_ip" name="ordersn">
		</div>
		<input type="hidden" name="status" value="0" />
		<input type="submit" value="搜索" class="btn btn-darkorange active" />
	    <div class="fb_form">
					
			<div class="table_list" id="dataTable_type"></div>
	    </div>
</div>

<div class="page_content bg_gray" style="display: none;" id="rili_date">
	<div class="box-title">
        <h5>点击选择价格日期</h5>
        <span class="layui-layer-setwin">
            <a class="layui-layer-ico layui-layer-close layui-layer-close1" href="javascript:;" id="close-line-date"></a>
        </span>
    </div>
    <hr>
    <div>
		<div class="rili"></div>
    </div>
</div>

<div class="page-content">

	<div class="page-body">
		<ul class="nav nav-tabs" id="changeNavTab">
			<li class="active" data-val="0"><a>进行中 </a></li>
			<li class="tab-red" data-val="1"><a>已过期</a></li>
		</ul>
		<div class="tab-content clear">
			<form action="<?php echo site_url('admin/a/finance/getOrderDetailJson');?>" id='search_condition' method="post">
				<div class="form-group">
					<span class="search_title col_span">时间:</span>
					<input type="text" class="form-control col_ip" name="linename">
				</div>
				<div class="form-group">
					<span class="search_title col_span">用户账号/用户昵称:</span>
					<input type="text" class="form-control col_ip" name="ordersn">
				</div>
				<input type="hidden" name="status" value="0" />
				<input type="submit" value="搜索" class="btn btn-darkorange active" />
				<input type="submit" value="新建任务单" class="btn new_task_btn" onclick='new_task_btn()'/>
			</form>
			<div id="dataTable"></div>
		</div>
	</div>
</div>
<div id="orderDetail"></div>
</body>
<script type="text/javascript" src="/assets/js/jquery.pageTable.js"></script>
<script src="<?php echo base_url("assets/js/jquery.detailbox.js") ;?>"></script>
<script type="text/javascript" src="<?php echo base_url("assets/ht/js/layer.js"); ?>"></script>
<script type="text/javascript" src="<?php echo base_url("assets/js/rili.js"); ?>" ></script>
<script>
var columns = [ {field : 'receipt',title : '任务单编号',width : '130',align : 'center'},
				{field : 'ordersn',title : '对应线路',width : '90',align : 'center'},
				{field : 'linename',title : '线路编号',width : '200',align : 'center'},
				{field : 'cityname',title : '用户账号',align : 'center', width : '140'},
				{field : 'addtime',title : '用户昵称',align : 'center', width : '130'},
				{field : 'amount',title : '出行日期',align : 'center', width : '90'},
				{field : false,title : '操作',align : 'center', width : '120',formatter: function(item) {
					return "<a href='javascript:void(0);' onclick='detail("+item.id+")' class='btn btn-info btn-xs edit'>查看</a><a href='javascript:void(0);' onclick='amend("+item.id+")' class='btn btn-info btn-xs edit'>修改</a>";
				}
			}];
var columns1 = [ {field : 'receipt',title : '用户账号',width : '130',align : 'center'},
				{field : 'ordersn',title : '用户昵称',width : '90',align : 'center'},
				{field : 'linename',title : '申请时间',width : '200',align : 'center'},
				{field : 'cityname',title : '提现金额(RMB)',align : 'center', width : '140'},
				{field : 'approvetime',title : '平台抽成(RMB)',align : 'center', width : '130'},
				{field : 'amount',title : '绑定银行',align : 'center', width : '90'},
				{field : 'amount',title : '银行卡号',align : 'center', width : '90'},
				{field : 'supplier_name',title : '户名',align : 'center', width : '140'},
				{field : 'expert_name',title : '提现时间',align : 'center', width : '110'},
				{field : 'description',title : '操作人',align : 'center', width : '110'}]	

var columns_line = [ {field : 'receipt',title : '线路编号',width : '100',align : 'center'},
				{field : 'ordersn',title : '对应线路',width : '200',align : 'center'},
				{field : false,title : '操作',align : 'center', width : '90',formatter: function(item) {
					return "<a href='javascript:void(0);' onclick='choose_line("+item.id+")' class='btn btn-info btn-xs edit'>选择</a>"
				}}]						
						
$("#dataTable").pageTable({
	columns:columns,
	url:'/admin/a/finance/getOrderDetailJson',
	searchForm:'#search_condition',
	pageNumNow:1
});
$("#changeNavTab li").click(function() {
	$("#search_condition").find("input[type=text]").val('');
	var status = $(this).attr("data-val");
	$("input[name='status']").val(status);
	$(this).addClass("active").siblings("li").removeClass("active");
	if (status == 0) {
		$("#dataTable").pageTable({
			columns:columns,
			url:'/admin/a/finance/getOrderDetailJson',
			searchForm:'#search_condition',
			pageNumNow:1
		});
	} else if (status == 1) {
		$("#dataTable").pageTable({
			columns:columns1,
			url:'/admin/a/finance/getOrderDetailJson',
			searchForm:'#search_condition',
			pageNumNow:1
		});
	} 
	
})
//查看定制单详细
function detail(id) {
	// $.ajax({
	// 	type:"POST",
	// 	url:"/admin/a/finance/getOrderDetailData",
	// 	dataType:"json",
	// 	data:{id:id},
	// 	success:function(data) {
	// 		if ($.isEmptyObject(data) === false) {
	// 			see_detail(data);
	// 		} else {
	// 			alert("请确认您选择的数据");
	// 		}
	// 	}
	// });
	layer.open({
           type: 1,
           title: false,
           closeBtn: 0,
           area: '850px',
          //skin: 'layui-layer-nobg', //没有背景色
           shadeClose: false,
           content: $('#cashsub')
     });
	$("#different_h4").text("提现操作");
	$("#different_td").text("实际提现");
	$("#different_input").removeClass("input_width").addClass("input_wid");
}

function amend(id) {
	// $.ajax({
	// 	type:"POST",
	// 	url:"/admin/a/finance/getOrderDetailData",
	// 	dataType:"json",
	// 	data:{id:id},
	// 	success:function(data) {
	// 		if ($.isEmptyObject(data) === false) {
	// 			see_detail(data);
	// 		} else {
	// 			alert("请确认您选择的数据");
	// 		}
	// 	}
	// });
	layer.open({
           type: 1,
           title: false,
           closeBtn: 0,
           area: '700px',
          //skin: 'layui-layer-nobg', //没有背景色
           shadeClose: false,
           content: $('#amend')
     });
}

$(".new_btn").click(function(){
	var html = ""
	var task_lg = $(".task_header div").length;
	if(task_lg==4){
		var html ='<div><label>任务五:</label><input type="text" name="task5" class="task"><input type="text" name="task5_time"></div>'
	}
	else if(task_lg==5){
		var html ='<div><label>任务六:</label><input type="text" name="task6" class="task"><input type="text" name="task6_time"></div>'
	}
	else if(task_lg==6){
		var html ='<div><label>任务七:</label><input type="text" name="task7" class="task"><input type="text" name="task7_time"></div>'
	}
	else{
		alert("最多可以添加七条任务!");
	}
	//var html ='<div><label>任务'+task_lg+':</label><input type="text" name="task6" class="task"><input type="text" name="task6_time"></div>'
	$(".task_header").append(html);
})

function new_task_btn() {
	// $.ajax({
	// 	type:"POST",
	// 	url:"/admin/a/finance/getOrderDetailData",
	// 	dataType:"json",
	// 	data:{id:id},
	// 	success:function(data) {
	// 		if ($.isEmptyObject(data) === false) {
	// 			see_detail(data);
	// 		} else {
	// 			alert("请确认您选择的数据");
	// 		}
	// 	}
	// });
	layer.open({
           type: 1,
           title: false,
           closeBtn: 0,
           area: '700px',
          //skin: 'layui-layer-nobg', //没有背景色
           shadeClose: false,
           content: $('#new_task')
     });
}

function chooseline() {
	layer.open({
           type: 1,
           title: false,
           closeBtn: 0,
           area: '750px',
          //skin: 'layui-layer-nobg', //没有背景色
           shadeClose: false,
           content: $('#form2_add')
     });
	$("#dataTable_type").pageTable({
		columns:columns_line,
		url:'/admin/a/finance/getOrderDetailJson',
		searchForm:'#search_condition',
		pageNumNow:1
	});
}

function choose_line() {
	$('#close-line').click();
	layer.open({
           type: 1,
           title: false,
           closeBtn: 0,
           area: '750px',
          //skin: 'layui-layer-nobg', //没有背景色
           shadeClose: false,
           content: $('#rili_date')
     });
}

	$(".rili").rili();
	getSetMealPrice();
	/**************套餐日历**********************/
	//获取日历套餐并使用第一个套餐获取日历
	
	function getSetMealPrice(){	
		$.ajax({
			 type: "get",
			 url: "https://www.1b1u.com/api/v2_3_15/c/cfgm_price_date",
			 data: {suitid : 32966},
			 dataType : "jsonp",
			 jsonp:"jsoncallback",			 
			 success: function(ret){
			 	//console.log(ret)
				if(ret){
					var myDate = new Date();
					var oMonth = myDate.getMonth()+1;
					var oDate = myDate.getDate();
					var oDay = myDate.getDay()+1;
					var riliMonth = $(".riliMonth").html();
					$(".cutPay").remove(); // 清除之后重新加载添加数据
					//console.log(ret)
					var dataDay =ret.common.now_month_day; 
					var classMonth = oMonth;
					var clasMonth = "0"+oMonth;
					var subMonth = clasMonth.substring(-2,2)
					var newMonth = $(".riliMonth").html();
					if( newMonth.length == 1 ){
						newMonth = "0"+newMonth;
					}
					$.each(ret.data.rows ,function(k ,v) {
						// var day = k.substring(8);
						// var m = k.substring(5 ,7);
						// console.log(k);
						//$("div[data='"+day+m+"']").append("<div class='cutPay'>¥"+v.adult_price+"</div>");
						$("div[data-day='"+k+"']").css({"color":"#666666","fontSize":"12px"}).append("<p class='cal_price'>￥"+v.adult_price+"</p>").click(function(){
								var group_date=$(this).attr("data-day");
								//自定义点击事件
								$(".line_date").text(group_date);
								$('#close-line-date').click();
							});
					});
				}
			 }
		});			
	}	
	//获取 点击之后的日历
	function get_suitidAndDate( suitid , date ){
		suit_id = suitid;
		day = date;
		$("#cy_date").html( day );
	}	
</script>
